<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Post-Election Reflection | A minimal Hugo website</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Post-Election Reflection</span></h1>
<h2 class="author">Avi Agarwal</h2>
<h2 class="date">2024/11/18</h2>
</div>

<main>
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/kePrint/kePrint.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/kePrint/kePrint.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/kePrint/kePrint.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/kePrint/kePrint.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/plotly-binding/plotly.js"></script>
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/typedarray/typedarray.min.js"></script>
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/jquery/jquery.min.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/crosstalk/js/crosstalk.min.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/plotly-main/plotly-latest.min.js"></script>
<script src="https://example.org/post/2024/11/18/post-election-reflection/index_files/kePrint/kePrint.js"></script>
<link href="https://example.org/post/2024/11/18/post-election-reflection/index_files/lightable/lightable.css" rel="stylesheet" />
<pre><code class="language-r">library(tidyverse)
</code></pre>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.4.4     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.0
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
</code></pre>
<pre><code class="language-r">library(knitr)
library(plotly)
</code></pre>
<pre><code>## Warning: package 'plotly' was built under R version 4.3.3

## 
## Attaching package: 'plotly'
## 
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
## 
## The following object is masked from 'package:stats':
## 
##     filter
## 
## The following object is masked from 'package:graphics':
## 
##     layout
</code></pre>
<pre><code class="language-r">library(maps)
</code></pre>
<pre><code>## 
## Attaching package: 'maps'
## 
## The following object is masked from 'package:purrr':
## 
##     map
</code></pre>
<pre><code class="language-r">library(car)
</code></pre>
<pre><code>## Warning: package 'car' was built under R version 4.3.3

## Loading required package: carData

## Warning: package 'carData' was built under R version 4.3.3

## 
## Attaching package: 'car'
## 
## The following object is masked from 'package:dplyr':
## 
##     recode
## 
## The following object is masked from 'package:purrr':
## 
##     some
</code></pre>
<pre><code class="language-r">library(CVXR)
</code></pre>
<pre><code>## Warning: package 'CVXR' was built under R version 4.3.3

## 
## Attaching package: 'CVXR'
## 
## The following object is masked from 'package:dplyr':
## 
##     id
## 
## The following object is masked from 'package:purrr':
## 
##     is_vector
## 
## The following object is masked from 'package:stats':
## 
##     power
</code></pre>
<pre><code class="language-r">library(stringr)
library(knitr)
library(kableExtra)
</code></pre>
<pre><code>## Warning: package 'kableExtra' was built under R version 4.3.3

## 
## Attaching package: 'kableExtra'
## 
## The following object is masked from 'package:dplyr':
## 
##     group_rows
</code></pre>
<pre><code class="language-r">library(caret)
</code></pre>
<pre><code>## Warning: package 'caret' was built under R version 4.3.3

## Loading required package: lattice
## 
## Attaching package: 'caret'
## 
## The following object is masked from 'package:purrr':
## 
##     lift
</code></pre>
<pre><code class="language-r">library(yardstick)
</code></pre>
<pre><code>## Warning: package 'yardstick' was built under R version 4.3.3

## 
## Attaching package: 'yardstick'
## 
## The following objects are masked from 'package:caret':
## 
##     precision, recall, sensitivity, specificity
## 
## The following object is masked from 'package:readr':
## 
##     spec
</code></pre>
<pre><code class="language-r">set.seed(02138)
</code></pre>
<p><strong>Model 1:</strong><br>
</p>
$$
`\begin{aligned}
D\_pv2p = & \, \alpha + \beta_1(\text{state}) + \beta_2(\text{D\_pv2p\_lag1}) + \beta_3(\text{D\_pv2p\_lag2}) \\
& + \beta_4(\text{updated\_rdpi} \times \text{incumbent\_party}) + \beta_5(\text{dpi\_inflation\_adjusted} \times \text{incumbent\_party}) + \epsilon
\end{aligned}`
  $$<p>
<strong>Model 2:</strong><br>
</p>
$$
`\begin{aligned}
D\_pv2p = & \, \alpha + \beta_1(\text{state}) + \beta_2(\text{polling\_trend\_5\_1}) + \beta_3(\text{polling\_trend\_10\_6}) \\
& + \beta_4(\text{current\_week}) + \beta_5(\text{support\_DEM\_1}) + \beta_6(\text{support\_DEM\_2}) + \beta_7(\text{support\_DEM\_3}) + \epsilon
\end{aligned}`
  $$<p>
<strong>Model 3:</strong><br>
</p>
$$
`\begin{aligned}
D\_pv2p = & \, \alpha + \beta_1(\text{state}) + \beta_2(\text{D\_pv2p\_lag1}) + \beta_3(\text{D\_pv2p\_lag2}) + \beta_4(\text{support\_DEM\_1}) \\
& + \beta_5(\text{polling\_trend\_5\_1}) + \beta_6(\text{polling\_trend\_10\_6}) + \beta_7(\text{dpi\_inflation\_adjusted} \times \text{incumbent\_party}) \\
& + \beta_8(\text{unemployment\_growth\_quarterly} \times \text{incumbent\_party}) + \beta_9(\text{updated\_rdpi} \times \text{incumbent\_party}) + \epsilon
\end{aligned}`
  $$<pre><code class="language-r">weights_df &lt;- read_csv(&quot;weights_df.csv&quot;) |&gt;
  kable(&quot;html&quot;, 
        col.names = c(&quot;State&quot;, &quot;Model 1&quot;, &quot;Model 2&quot;, &quot;Model 3&quot;),
        caption = &quot;Model Weights by State&quot;, digits = 3) %&gt;%
  kable_styling(full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;)) %&gt;%
  column_spec(1, width = &quot;8em&quot;, extra_css = &quot;text-align: center;&quot;) %&gt;%
  column_spec(2:4, width = &quot;6em&quot;, extra_css = &quot;text-align: center;&quot;)
</code></pre>
<pre><code>## Rows: 7 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): State
## dbl (3): Weight.Model.1, Weight.Model.2, Weight.Model.3
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">weights_df
</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-2"></span>Table 1: Model Weights by State
</caption>
<thead>
<tr>
<th style="text-align:left;">
State
</th>
<th style="text-align:right;">
Model 1
</th>
<th style="text-align:right;">
Model 2
</th>
<th style="text-align:right;">
Model 3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Arizona
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.028
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.972
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Georgia
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.130
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.838
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.031
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Michigan
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.129
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.610
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.260
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Nevada
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.128
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.730
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.143
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
North Carolina
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.395
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.570
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.034
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Pennsylvania
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.031
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.958
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.010
</td>
</tr>
<tr>
<td style="text-align:left;width: 8em; text-align: center;">
Wisconsin
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.154
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.642
</td>
<td style="text-align:right;width: 6em; text-align: center;">
0.204
</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">swing_states &lt;- c(&quot;Arizona&quot;, &quot;Georgia&quot;, &quot;Michigan&quot;, &quot;Nevada&quot;, &quot;North Carolina&quot;, &quot;Pennsylvania&quot;, &quot;Wisconsin&quot;)

avi_preds &lt;- read_csv(&quot;avi_2024_preds - Sheet1.csv&quot;)
</code></pre>
<pre><code>## Rows: 7 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): state
## dbl (1): Dv2p
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">state_vote_2024 &lt;- read_csv(&quot;state_votes_pres_2024.csv&quot;) |&gt;
  filter(row_number() != 1) |&gt;
  select(c(&quot;Geographic Name&quot;, &quot;Total Vote&quot;, &quot;Kamala D. Harris&quot;, &quot;Donald J. Trump&quot;)) |&gt;
  mutate(
    state = `Geographic Name`,
    `Total Vote` = as.numeric(`Total Vote`),
    `Kamala D. Harris` = as.numeric(`Kamala D. Harris`),
    `Donald J. Trump` = as.numeric(`Donald J. Trump`)
  ) |&gt;
  filter(state %in% swing_states) |&gt;
  mutate(Dv2p_real = `Kamala D. Harris` / (`Kamala D. Harris` + `Donald J. Trump`)*100)
</code></pre>
<pre><code>## New names:
## Rows: 52 Columns: 42
## ── Column specification
## ──────────────────────────────────────────────────────── Delimiter: &quot;,&quot; chr
## (42): FIPS, Geographic Name, Geographic Subtype, Total Vote, Kamala D. H...
## ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## • `0` -&gt; `0...31`
## • `0` -&gt; `0...32`
## • `0` -&gt; `0...33`
## • `0` -&gt; `0...34`
## • `0` -&gt; `0...35`
## • `0` -&gt; `0...36`
## • `0` -&gt; `0...37`
## • `0` -&gt; `0...38`
## • `0` -&gt; `0...39`
## • `0` -&gt; `0...40`
## • `0` -&gt; `0...41`
## • `0` -&gt; `0...42`
</code></pre>
<pre><code class="language-r">state_vote_2024 &lt;- state_vote_2024 |&gt;
  left_join(avi_preds, by = &quot;state&quot;)
</code></pre>
<pre><code class="language-r">state_vote_2024_table &lt;- state_vote_2024 |&gt;
  select(c(&quot;state&quot;, &quot;Dv2p_real&quot;, &quot;Dv2p&quot; )) |&gt;
  mutate(across(where(is.numeric), round, digits = 3)) |&gt;
  kable(
    caption = &quot;2024 Presidential Election Results by State&quot;,
    col.names = c(&quot;State&quot;, &quot;Real Democratic Vote Share (%)&quot;, &quot;Predicted Democratic Vote Share (%)&quot;),
    format = &quot;html&quot;
  ) |&gt;
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;)
  )
</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `across(where(is.numeric), round, digits = 3)`.
## Caused by warning:
## ! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
## Supply arguments directly to `.fns` through an anonymous function instead.
## 
##   # Previously
##   across(a:b, mean, na.rm = TRUE)
## 
##   # Now
##   across(a:b, \(x) mean(x, na.rm = TRUE))
</code></pre>
<pre><code class="language-r">state_vote_2024_table  
</code></pre>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-5"></span>Table 2: 2024 Presidential Election Results by State
</caption>
<thead>
<tr>
<th style="text-align:left;">
State
</th>
<th style="text-align:right;">
Real Democratic Vote Share (%)
</th>
<th style="text-align:right;">
Predicted Democratic Vote Share (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Arizona
</td>
<td style="text-align:right;">
47.153
</td>
<td style="text-align:right;">
47.69
</td>
</tr>
<tr>
<td style="text-align:left;">
Georgia
</td>
<td style="text-align:right;">
48.878
</td>
<td style="text-align:right;">
49.23
</td>
</tr>
<tr>
<td style="text-align:left;">
Michigan
</td>
<td style="text-align:right;">
49.302
</td>
<td style="text-align:right;">
51.41
</td>
</tr>
<tr>
<td style="text-align:left;">
Nevada
</td>
<td style="text-align:right;">
48.378
</td>
<td style="text-align:right;">
51.68
</td>
</tr>
<tr>
<td style="text-align:left;">
North Carolina
</td>
<td style="text-align:right;">
48.299
</td>
<td style="text-align:right;">
49.24
</td>
</tr>
<tr>
<td style="text-align:left;">
Pennsylvania
</td>
<td style="text-align:right;">
48.982
</td>
<td style="text-align:right;">
50.30
</td>
</tr>
<tr>
<td style="text-align:left;">
Wisconsin
</td>
<td style="text-align:right;">
49.532
</td>
<td style="text-align:right;">
50.68
</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">win_counts &lt;- read_csv(&quot;win_counts.csv&quot;)
</code></pre>
<pre><code>## Rows: 1 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Harris Victory %
## dbl (2): Harris Victory Wins, Trump Victory Wins
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">sim_table &lt;- win_counts %&gt;%
  kable(&quot;html&quot;, caption = &quot;Simulation Results: Harris and Trump Victory Counts&quot;) %&gt;%
  kable_styling(full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;), position = &quot;center&quot;) %&gt;%
  column_spec(1, width = &quot;5em&quot;, extra_css = &quot;text-align: center;&quot;) %&gt;%
  column_spec(2, width = &quot;5em&quot;, extra_css = &quot;text-align: center;&quot;) %&gt;%
  column_spec(3, width = &quot;5em&quot;, extra_css = &quot;text-align: center;&quot;)

sim_table
</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-6"></span>Table 3: Simulation Results: Harris and Trump Victory Counts
</caption>
<thead>
<tr>
<th style="text-align:right;">
Harris Victory Wins
</th>
<th style="text-align:right;">
Trump Victory Wins
</th>
<th style="text-align:left;">
Harris Victory %
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 5em; text-align: center;">
589
</td>
<td style="text-align:right;width: 5em; text-align: center;">
411
</td>
<td style="text-align:left;width: 5em; text-align: center;">
58.9%
</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">MSE &lt;- state_vote_2024 |&gt;
  mutate(
    error_squared = (Dv2p_real - Dv2p)^2,
    abs_error = abs(Dv2p_real - Dv2p)
  ) |&gt;
  group_by(state) |&gt;
  summarise(
    Bias = mean(Dv2p_real - Dv2p),
    MSE = mean(error_squared),
    RMSE = sqrt(MSE),
    MAE = mean(abs_error)
  )

average_row &lt;- state_vote_2024 |&gt;
  summarise(
    state = &quot;Average&quot;,
    Bias = mean(Dv2p_real - Dv2p),
    MSE = mean((Dv2p_real - Dv2p)^2),
    RMSE = mean(sqrt(MSE)),
    MAE = mean(abs(Dv2p_real - Dv2p))
  )


MSE &lt;- bind_rows(MSE, average_row) |&gt;
  rename(&quot;State&quot; = state)

MSE_table &lt;- MSE |&gt;
  mutate(across(where(is.numeric), round, digits = 3)) |&gt;
  kable(
    caption = &quot;State-Level MSE Table&quot;,
    col.names = c(&quot;State&quot;, &quot;Bias&quot;, &quot;MSE&quot;, &quot;RMSE&quot;, &quot;MAE&quot;),
    format = &quot;html&quot;
  ) |&gt;
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;)
  )

MSE_table
</code></pre>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-7"></span>Table 4: State-Level MSE Table
</caption>
<thead>
<tr>
<th style="text-align:left;">
State
</th>
<th style="text-align:right;">
Bias
</th>
<th style="text-align:right;">
MSE
</th>
<th style="text-align:right;">
RMSE
</th>
<th style="text-align:right;">
MAE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Arizona
</td>
<td style="text-align:right;">
-0.537
</td>
<td style="text-align:right;">
0.289
</td>
<td style="text-align:right;">
0.537
</td>
<td style="text-align:right;">
0.537
</td>
</tr>
<tr>
<td style="text-align:left;">
Georgia
</td>
<td style="text-align:right;">
-0.352
</td>
<td style="text-align:right;">
0.124
</td>
<td style="text-align:right;">
0.352
</td>
<td style="text-align:right;">
0.352
</td>
</tr>
<tr>
<td style="text-align:left;">
Michigan
</td>
<td style="text-align:right;">
-2.108
</td>
<td style="text-align:right;">
4.446
</td>
<td style="text-align:right;">
2.108
</td>
<td style="text-align:right;">
2.108
</td>
</tr>
<tr>
<td style="text-align:left;">
Nevada
</td>
<td style="text-align:right;">
-3.302
</td>
<td style="text-align:right;">
10.901
</td>
<td style="text-align:right;">
3.302
</td>
<td style="text-align:right;">
3.302
</td>
</tr>
<tr>
<td style="text-align:left;">
North Carolina
</td>
<td style="text-align:right;">
-0.941
</td>
<td style="text-align:right;">
0.886
</td>
<td style="text-align:right;">
0.941
</td>
<td style="text-align:right;">
0.941
</td>
</tr>
<tr>
<td style="text-align:left;">
Pennsylvania
</td>
<td style="text-align:right;">
-1.318
</td>
<td style="text-align:right;">
1.736
</td>
<td style="text-align:right;">
1.318
</td>
<td style="text-align:right;">
1.318
</td>
</tr>
<tr>
<td style="text-align:left;">
Wisconsin
</td>
<td style="text-align:right;">
-1.148
</td>
<td style="text-align:right;">
1.319
</td>
<td style="text-align:right;">
1.148
</td>
<td style="text-align:right;">
1.148
</td>
</tr>
<tr>
<td style="text-align:left;">
Average
</td>
<td style="text-align:right;">
-1.387
</td>
<td style="text-align:right;">
2.814
</td>
<td style="text-align:right;">
1.678
</td>
<td style="text-align:right;">
1.387
</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">map_data &lt;- MSE |&gt;
  mutate(state = tolower(State)) 

us_states &lt;- map_data(&quot;state&quot;)


swing_map_data &lt;- us_states %&gt;%
  filter(region %in% map_data$state) %&gt;%
  left_join(map_data, by = c(&quot;region&quot; = &quot;state&quot;))

swing_map_data &lt;- swing_map_data %&gt;%
  distinct(region, .keep_all = TRUE) %&gt;%
  mutate(state = tools::toTitleCase(region)) %&gt;%
  mutate(state_code = state.abb[match(state, state.name)]) |&gt;
  mutate(region = tools::toTitleCase(region))

map_plot &lt;- plot_ly(
  data = swing_map_data,
  type = &quot;choropleth&quot;,
  locations = ~state_code,
  locationmode = &quot;USA-states&quot;,
  z = ~Bias,
  text = ~paste(&quot;State:&quot;, region, &quot;&lt;br&gt;Bias:&quot;, round(Bias, 2), &quot;%&quot;),
  hoverinfo = &quot;text&quot;,
  colorscale = list(c(0, &quot;darkblue&quot;), c(0.5, &quot;white&quot;), c(1, &quot;darkred&quot;)),
  zmin = -4,   
  zmid = 0,     
  zmax = 4,    
  colorbar = list(
    title = &quot;Model Bias \n(Blue = Overestimated \nDem. Vote %)&quot;,
    y = 0.5,           
    yanchor = &quot;middle&quot; 
  )
) %&gt;%
  layout(
    title = list(
      text = &quot;Swing State Model Bias&quot;,
      y = 0.95,
      x = 0.5,
      xanchor = &quot;center&quot;,
      yanchor = &quot;top&quot;
    ),
    geo = list(
      scope = &quot;usa&quot;,
      projection = list(type = &quot;albers usa&quot;),
      showlakes = FALSE,
      showcountries = FALSE,
      showcoastlines = FALSE,
      coastlinecolor = toRGB(&quot;white&quot;),
      showframe = FALSE
    )
  )
map_plot
</code></pre>
<div class="plotly html-widget html-fill-item" id="htmlwidget-1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"visdat":{"868c35f4512e":["function () ","plotlyVisDat"]},"cur_data":"868c35f4512e","attrs":{"868c35f4512e":{"locations":{},"locationmode":"USA-states","z":{},"text":{},"hoverinfo":"text","colorscale":[["0","darkblue"],["0.5","white"],["1","darkred"]],"zmin":-4,"zmid":0,"zmax":4,"colorbar":{"title":"Model Bias <br />(Blue = Overestimated <br />Dem. Vote %)","y":0.5,"yanchor":"middle"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"choropleth"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"Swing State Model Bias","y":0.94999999999999996,"x":0.5,"xanchor":"center","yanchor":"top"},"geo":{"scope":"usa","projection":{"type":"albers usa"},"showlakes":false,"showcountries":false,"showcoastlines":false,"coastlinecolor":"rgba(255,255,255,1)","showframe":false},"scene":{"zaxis":{"title":"Bias"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"Model Bias <br />(Blue = Overestimated <br />Dem. Vote %)","ticklen":2,"y":0.5,"yanchor":"middle","len":0.5,"lenmode":"fraction"},"colorscale":[["0","darkblue"],["0.5","white"],["1","darkred"]],"showscale":true,"locations":["AZ","GA","MI","NV","NC","PA","WI"],"locationmode":"USA-states","z":[-0.53747346355770276,-0.35155030253291386,-2.1084448240057725,-3.3017124462760208,-0.94110553222387239,-1.3176535411938204,-1.148442057732332],"text":["State: Arizona <br>Bias: -0.54 %","State: Georgia <br>Bias: -0.35 %","State: Michigan <br>Bias: -2.11 %","State: Nevada <br>Bias: -3.3 %","State: North Carolina <br>Bias: -0.94 %","State: Pennsylvania <br>Bias: -1.32 %","State: Wisconsin <br>Bias: -1.15 %"],"hoverinfo":["text","text","text","text","text","text","text"],"zmin":-4,"zmid":0,"zmax":4,"type":"choropleth","marker":{"line":{"color":"rgba(31,119,180,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre><code class="language-r">state_vote_2024 &lt;- state_vote_2024 |&gt;
  mutate(
    actual = ifelse(Dv2p_real &gt;= 50, 1, 0),
    predicted = ifelse(Dv2p &gt;= 50, 1, 0),
    predicted_prob = Dv2p / 100
  )

actual_factor &lt;- factor(state_vote_2024$actual, levels = c(0, 1))
predicted_factor &lt;- factor(state_vote_2024$predicted, levels = c(0, 1))

confusion_matrix &lt;- confusionMatrix(predicted_factor, actual_factor)

# Extract relevant metrics from the confusion matrix
metrics &lt;- data.frame(
  Metric = c(&quot;Accuracy&quot;, &quot;Sensitivity (Recall)&quot;, &quot;Specificity&quot;, &quot;Precision&quot;, &quot;F1 Score&quot;),
  Value = c(
    round(confusion_matrix$overall['Accuracy'], 3),
    round(confusion_matrix$byClass['Sensitivity'], 3),
    round(confusion_matrix$byClass['Specificity'], 3),
    round(confusion_matrix$byClass['Pos Pred Value'], 3),
    round(2 * (confusion_matrix$byClass['Pos Pred Value'] * confusion_matrix$byClass['Sensitivity']) /
          (confusion_matrix$byClass['Pos Pred Value'] + confusion_matrix$byClass['Sensitivity']), 3)
  )
)

# Display the table using kable
kable(metrics, caption = &quot;Confusion Matrix Metrics&quot;, format = &quot;html&quot;) %&gt;%
  kable_styling(full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;))
</code></pre>
<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-9"></span>Table 5: Confusion Matrix Metrics
</caption>
<thead>
<tr>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:right;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Accuracy
</td>
<td style="text-align:right;">
0.429
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivity (Recall)
</td>
<td style="text-align:right;">
0.429
</td>
</tr>
<tr>
<td style="text-align:left;">
Specificity
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Precision
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
F1 Score
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">pred_chance &lt;- win_counts |&gt; 
  mutate(pred_chance = `Harris Victory Wins`/ 1000) |&gt;
  select(&quot;pred_chance&quot;)
brier_score &lt;- mean((pred_chance$pred_chance - 0)^2) |&gt;
  round(3)

print(brier_score)
</code></pre>
<pre><code>## [1] 0.347
</code></pre>

</main>

  <footer>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="//cdn.jsdelivr.net/combine/npm/katex/dist/katex.min.js,npm/katex/dist/contrib/auto-render.min.js,npm/@xiee/utils/js/render-katex.js" defer></script>

<script src="//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js" defer></script>

  
  <hr/>
  © <a href="https://yihui.org">Yihui Xie</a> 2017 &ndash; 2024 | <a href="https://github.com/yihui">Github</a> | <a href="https://twitter.com/xieyihui">Twitter</a>
  
  </footer>
  </body>
</html>

