---
title: 'Week #6: Improving Electoral College Model'
author: 'Avi '
date: '2024-10-14'
slug: week-6-improving-model-spending
categories: []
tags: []
---

```{r , echo= FALSE, message = FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
library(sjPlot)
library(plotly)
library(maps)
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
state_polls <- read_csv("state_polls_1968-2024.csv")

```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_states <- c("Arizona", "Georgia", "Michigan", "Nevada", "North Carolina", "Pennsylvania", "Wisconsin")
swing_state_polls <- state_polls |>
  filter(state %in% swing_states & weeks_left < 15 & weeks_left >= 4 & party == "DEM") |>
  group_by(state, year,  weeks_left) |>
  summarize(avg = mean(poll_support)) |>
  ungroup() |>
  pivot_wider(names_from = weeks_left, values_from = avg) |>
  mutate(`13` = ifelse(row_number() == 57, 44.71145, `13`),
        `14` = ifelse(row_number() == 57, 44.71145, `14`),
         `13` = ifelse(row_number() == 44, 44.35786, `13`),
         `14` = ifelse(row_number() == 44, 44.35786, `14`)) |>
  mutate(polling_trend_8_4 = `4` - `8`,
         polling_trend_12_8 = `9` - `14`,
         average_polling = rowMeans(across(`4`:`14`))) |>
  na.omit() |>
  select(year, state, polling_trend_8_4, polling_trend_12_8, average_polling)
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
state_dpi <- read_csv("Table.csv") 
state_dpi[, 28:77] <- lapply(state_dpi[, 28:77], as.numeric)
state_dpi <- state_dpi %>% select(-c(3:27))
state_dpi <- state_dpi |> 
  mutate(state = GeoName) |>
  select(-GeoName, -GeoFips) 

```

```{r , echo= FALSE, message = FALSE, warning=FALSE}

swing_state_dpi <- state_dpi |>
  filter(state %in% swing_states) |>
  pivot_longer(cols = `1974`:`2023`, names_to = "year", values_to = "percent_change_dpi") |>
  mutate(year = as.numeric(year)) |>
  mutate(election_year = year + 1) |>
  filter(election_year %% 4 == 0) |>
  select(-year) |>
  rename(year = election_year) 
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
yearly_inflation <- read_csv("yearly_inflation.csv")
yearly_inflation <- yearly_inflation |> 
  select(-c(1:4)) |>
  pivot_longer(cols = 1:64, names_to = "year", values_to = "yearly_national_inflation")

```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
yearly_inflation <- yearly_inflation |> 
  mutate(year = as.numeric(year)) |>
  mutate(year = year + 1) |>
  mutate(yearly_national_inflation = as.numeric(yearly_national_inflation)) 
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_state_dpi_inflation <- swing_state_dpi |>
  left_join(yearly_inflation, by = "year") |>
  mutate(dpi_inflation_adjusted = percent_change_dpi - yearly_national_inflation) |>
  select(-percent_change_dpi, -yearly_national_inflation)
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_state_data <- swing_state_polls |>
  left_join(swing_state_dpi_inflation, by = c("year","state"))
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
state_pop_vote <- read_csv("state_popvote_1948_2020.csv")
state_pop_vote_fixed <- state_pop_vote |>
  filter(state %in% swing_states) |>
  select(-c(D_pv, R_pv_lag2, R_pv, R_pv_lag1, R_pv2p, D_pv_lag1, D_pv_lag2, margin, winner, R_pv2p_lag1, R_pv2p_lag2)) 

  
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_state_data <- swing_state_data |>
  left_join(state_pop_vote_fixed, by = c("year", "state"))
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
nat_pop_vote <- read_csv("popvote_1948_2020.csv") |>
  filter(party == "democrat") |> 
  select(year, incumbent_party) |>
  mutate(incumbent_party = ifelse(incumbent_party == TRUE, 1, 0))
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_state_data <- swing_state_data |>
  left_join(nat_pop_vote, by = "year")
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
fred_econ <- read_csv("fred_econ.csv") 
fred_adjusted <- fred_econ |>
  filter(year > 1958) |>
  mutate(unemployment_growth_quarterly = (unemployment - lag(unemployment, 1)) / lag(unemployment, 1) * 100) |>
  filter(quarter == 2) |>
  mutate(RDPI_growth_annually = (RDPI - lag(RDPI, 1)) / lag(RDPI, 1) * 100) |> 
  mutate(sp500_growth_quarterly = ((sp500_adj_close - sp500_open)) / sp500_open * 100) |>
  mutate(sp500_growth_anually = (sp500_adj_close - lag(sp500_adj_close, 1)) / lag(sp500_adj_close, 1) * 100) |> 
  mutate(unemployment_growth_anually = (unemployment - lag(unemployment, 1)) / lag(unemployment, 1) * 100) |>
  filter(year >= 1960 & year %% 4 == 0) |>
  select(year, RDPI_growth_quarterly)

```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
 swing_state_data <-  swing_state_data |>
  left_join(fred_adjusted, by = "year")
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
state_dummies <- model.matrix(~ state - 1, data = swing_state_data)

swing_state_data <- cbind(swing_state_data, state_dummies)

swing_state_data_train <- swing_state_data |>
  filter(year < 2024)
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
elec_college_model <- lm(
  data = swing_state_data_train, 
  D_pv2p ~ 0 + polling_trend_8_4 + polling_trend_12_8 + average_polling + 
           incumbent_party + dpi_inflation_adjusted + RDPI_growth_quarterly + stateArizona + stateGeorgia + stateMichigan + stateNevada + `stateNorth Carolina` + stateWisconsin + statePennsylvania) 

```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
swing_state_data_test <- swing_state_data |>
  filter(year == 2024) 
```


```{r , echo= FALSE, message = FALSE, warning=FALSE}
elec_college_results <- predict(elec_college_model, swing_state_data_test, interval = "prediction")
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
lm_in_sample_predictions <- predict(elec_college_model, swing_state_data_train)
in_sample_mse <- mean((swing_state_data_train$D_pv2p - lm_in_sample_predictions)^2)


#Used ChatGPT to help make this table
elec_college_summary_dems <- tab_model(elec_college_model,
                                       show.p = TRUE,   
                                       show.r2 = FALSE, 
                                       show.se = TRUE,   
                                       title = paste("Linear Regression Model for Democrat Two-Party Vote Share\n(In-sample MSE:", sprintf("%.4f", in_sample_mse), ")"),
                                       dv.labels = "Democrat Two-Party Vote Share",
                                       pred.labels = c("Polling Trend (Weeks 8-4)", "Polling Trend (Weeks 12-8)", 
                                                       "Average Polling", "Incumbent Party", 
                                                       "DPI Inflation Adjusted", "RDPI Growth Quarterly", 
                                                       "Arizona", "Georgia", "Michigan", "Nevada", 
                                                       "North Carolina", "Wisconsin", "Pennsylvania"))
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
elec_college_results_dems <- predict(elec_college_model, swing_state_data_test, interval = "prediction")


elec_college_results_df_dems <- as.data.frame(elec_college_results_dems)
colnames(elec_college_results_df_dems) <- c("Prediction", "Lower Bound", "Upper Bound")


elec_college_results_df_dems$SE <- (elec_college_results_df_dems$`Upper Bound` - elec_college_results_df_dems$Prediction) / 1.96

#Used ChatGPT to help make this table
elec_college_results_df_dems <- data.frame(
  state = swing_state_data_test$state,
  Prediction = sprintf("%.2f%% ± %.2f%%", elec_college_results_df_dems$Prediction, elec_college_results_df_dems$SE)
)



elec_college_pred_table_dems <- tab_df(elec_college_results_df_dems,
                                       title = "2024 Democrat Two-Party Vote Share Predictions in Swing States",
                                       show.rownames = FALSE)
```


# Introduction

As surprising as it might seem, we are less than 22 days away from the 2024 Election Day. As a result, this week, I focused solely on refining my electoral college prediction mode rather than adding any new predictors or techniques. This allowed me to make several substantial improvements to my model that will increase predictive potential. 

# Polling

I have adjusted how I incorporate polling into my models each week and have finally settled on a preferred method. Due to the last-minute candidate switch, one recurring challenge is the limited number of weeks with polling data for this election. This makes it difficult to eliminate any weeks of polling data through regularization methods like elastic net. Furthermore, modeling state-level predictors requires more historical data to apply the method to all the swing states. However, simply using an average removes the influence of polling trends on a candidate’s performance over time. While a weighted average could be helpful, it involves assigning arbitrary weights, which can lead to overfitting issues, like in week 4. As a result, I decided to use three distinct polling-based covariates in my model.

The first covariate is an average of all the weeks of polling between Harris and Trump, providing a baseline of predicted support for each candidate. The other two are trend indicators that measure changes in support over time. One measures the difference in support between 15 weeks and 9 weeks remaining, while the second measures from 8 weeks to 4 weeks remaining. This approach allows me to utilize the limited polling data while giving more weight to recent polls and accounting for trends that may influence vote share over time. Lastly, to maintain a complete dataset for each week, if no polling data was available for a specific week, I carried over the data from the nearest available poll to simulate the presence of data. I preferred this method over using historical data for imputation, as polling averages can vary significantly between elections due to factors like strong third-party candidates and name recognition.

# Economic Fundamentals

I believe both national and state-level economic factors are essential for determining state-level predictions. I only used national economic factors in my previous models, but I corrected that for this week. Unfortunately, robust state-level economic indicators are not widely available. No historical quarterly RDPI growth data is available at the state level, so I had to use the Bureau of Economic Analysis measure of annual personal income growth instead. Since no yearly data is available for 2024, I used the overall increase from the previous election year. For example, for 2020, I used the increase in 2019, and so on.

This data was not adjusted for inflation, so I attempted to find each state's Consumer Price Index increase by year. However, that data was also unavailable, so I used a national measure from the World Bank instead. While this means the estimates are not entirely accurate, inflation rates rarely vary drastically by state, so I was comfortable using it. Since I was using data from the preceding year, I also included the national Q2 RDPI increase, which refers to a separate period, meaning multicollinearity should not be an issue.

# Performance of Adjusted Models

In addition to the new covariates, I retained the incumbent party variable, reflecting how economic fundamentals should influence the candidate's performance. I slightly adjusted the regression format by excluding an intercept term, focusing solely on the direct effects of the swing state covariates without a reference category. As a result, the R-squared is exceptionally high, making it an unreliable measure of the model's predictive quality.

Instead, I calculated the in-sample MSE, 0.0554, or 5.54 percentage points. While still somewhat high, it is reasonable compared to other state-level models. It represents a significant improvement from last week’s model, which had an in-sample MSE of about 10.5 percentage points.

```{r , echo= FALSE, message = FALSE, warning=FALSE}
elec_college_summary_dems
```


Using this model for predictions, Harris is forecasted to win Michigan, Wisconsin, Pennsylvania, and Nevada, while Trump is predicted to win North Carolina, Arizona, and, narrowly, Georgia. This would result in a final electoral vote tally of 276 for Harris and 262 for Trump, leading to a narrow Harris victory.

```{r , echo= FALSE, message = FALSE, warning=FALSE}
elec_college_pred_table_dems
```

```{r , echo= FALSE, message = FALSE, warning=FALSE}
print(map)
```

```{r}
map
```

# Future Improvements

While this model shows significant improvement from last week, I plan to test several changes in the coming weeks to enhance its accuracy. I intend to experiment with an elastic net model using imputed data to see if that offers a better method for incorporating polling data. I will also explore modeling various economic fundamentals to create a more nuanced measure of economic effects in this election.

While campaign fundraising is a useful indicator of public support, strong data for 2024 are not yet available, making it difficult to make meaningful predictions in this area. However, I may also attempt to incorporate it into the model next week.





